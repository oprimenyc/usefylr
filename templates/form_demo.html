{% extends 'layout.html' %}

{% block title %}Form Library Demo{% endblock %}

{% block extra_head %}
<style>
  .form-section {
    margin-bottom: 2rem;
    border-bottom: 1px solid #e9ecef;
    padding-bottom: 1rem;
  }
  
  .form-progress {
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .bg-fylr {
    background-color: var(--fylr-orange);
  }
  
  .field-help {
    color: var(--fylr-orange);
    cursor: pointer;
  }
  
  .form-field {
    margin-bottom: 1.5rem;
  }
  
  .form-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
  }
  
  .input-group-text {
    background-color: #f8f9fa;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h1 class="h2 mb-0">Form Library Demo</h1>
            <p class="lead text-muted">Explore the expanded tax form library</p>
        </div>
    </div>
    
    <div class="row g-4">
        <div class="col-lg-3">
            <!-- Form Selection -->
            <div class="card shadow-sm mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Select Form</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for form_id, form_info in form_templates.items() %}
                            <a href="{{ url_for('form_demo') }}?form_id={{ form_id }}" 
                               class="list-group-item list-group-item-action {% if selected_form_id == form_id %}active{% endif %}">
                                {{ form_info.title }}
                                <div class="small text-{% if selected_form_id == form_id %}light{% else %}muted{% endif %}">
                                    {{ form_info.description[:60] }}...
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <!-- Form Actions -->
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0">Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary" id="saveBtn">
                            <i class="fas fa-save me-2"></i> Save Progress
                        </button>
                        <button type="button" class="btn btn-success" id="submitBtn">
                            <i class="fas fa-check-circle me-2"></i> Submit Form
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="resetBtn">
                            <i class="fas fa-undo me-2"></i> Reset Form
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-9">
            {% if form_template %}
                <div class="card shadow-sm">
                    <div class="card-header bg-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">{{ form_template.title }}</h5>
                            <span class="badge bg-primary">{{ form_template.metadata.tax_form_type }}</span>
                        </div>
                        <p class="text-muted mb-0 small">{{ form_template.description }}</p>
                    </div>
                    <div class="card-body">
                        <!-- Form Progress -->
                        <div class="form-progress-container mb-4">
                            <div class="progress">
                                <div class="progress-bar bg-fylr" role="progressbar" style="width: {{ (current_section + 1) / form_template.sections|length * 100 }}%;" 
                                    aria-valuenow="{{ (current_section + 1) / form_template.sections|length * 100 }}" aria-valuemin="0" aria-valuemax="100">
                                    Section {{ current_section + 1 }} of {{ form_template.sections|length }}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Form Content -->
                        <form id="demoForm">
                            <!-- Current Section -->
                            {% set section = form_template.sections[current_section] %}
                            <div class="form-section">
                                <h3>{{ section.title }}</h3>
                                <p class="text-muted">{{ section.description }}</p>
                                
                                {% for field in section.fields %}
                                    <div class="form-field">
                                        <!-- Text Field -->
                                        {% if field.type == 'text' %}
                                            <label for="{{ field.name }}" class="form-label">
                                                {{ field.label }}
                                                {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                <i class="fas fa-info-circle ms-1 field-help" data-bs-toggle="tooltip" title="{{ field.help_text }}"></i>
                                            </label>
                                            <input type="text" class="form-control" id="{{ field.name }}" name="{{ field.name }}" 
                                                   placeholder="{{ field.placeholder }}" 
                                                   {% if field.required %}required{% endif %}>
                                        
                                        <!-- Textarea Field -->
                                        {% elif field.type == 'textarea' %}
                                            <label for="{{ field.name }}" class="form-label">
                                                {{ field.label }}
                                                {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                <i class="fas fa-info-circle ms-1 field-help" data-bs-toggle="tooltip" title="{{ field.help_text }}"></i>
                                            </label>
                                            <textarea class="form-control" id="{{ field.name }}" name="{{ field.name }}" 
                                                      rows="{{ field.rows|default(3) }}" placeholder="{{ field.placeholder }}"
                                                      {% if field.required %}required{% endif %}></textarea>
                                        
                                        <!-- Number Field -->
                                        {% elif field.type == 'number' %}
                                            <label for="{{ field.name }}" class="form-label">
                                                {{ field.label }}
                                                {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                <i class="fas fa-info-circle ms-1 field-help" data-bs-toggle="tooltip" title="{{ field.help_text }}"></i>
                                            </label>
                                            <input type="number" class="form-control" id="{{ field.name }}" name="{{ field.name }}" 
                                                   {% if field.min_value is not none %}min="{{ field.min_value }}"{% endif %}
                                                   {% if field.max_value is not none %}max="{{ field.max_value }}"{% endif %}
                                                   {% if field.step %}step="{{ field.step }}"{% endif %}
                                                   {% if field.required %}required{% endif %}>
                                        
                                        <!-- Currency Field -->
                                        {% elif field.type == 'currency' %}
                                            <label for="{{ field.name }}" class="form-label">
                                                {{ field.label }}
                                                {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                <i class="fas fa-info-circle ms-1 field-help" data-bs-toggle="tooltip" title="{{ field.help_text }}"></i>
                                            </label>
                                            <div class="input-group">
                                                <span class="input-group-text">$</span>
                                                <input type="number" class="form-control" id="{{ field.name }}" name="{{ field.name }}" 
                                                       step="0.01" min="0"
                                                       {% if field.required %}required{% endif %}>
                                            </div>
                                        
                                        <!-- Date Field -->
                                        {% elif field.type == 'date' %}
                                            <label for="{{ field.name }}" class="form-label">
                                                {{ field.label }}
                                                {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                <i class="fas fa-info-circle ms-1 field-help" data-bs-toggle="tooltip" title="{{ field.help_text }}"></i>
                                            </label>
                                            <input type="date" class="form-control" id="{{ field.name }}" name="{{ field.name }}"
                                                   {% if field.min_date %}min="{{ field.min_date }}"{% endif %}
                                                   {% if field.max_date %}max="{{ field.max_date }}"{% endif %}
                                                   {% if field.required %}required{% endif %}>
                                        
                                        <!-- Checkbox Field -->
                                        {% elif field.type == 'checkbox' %}
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="{{ field.name }}" name="{{ field.name }}"
                                                      {% if field.required %}required{% endif %}>
                                                <label class="form-check-label" for="{{ field.name }}">
                                                    {{ field.label }}
                                                    {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                </label>
                                                <div class="form-text">{{ field.help_text }}</div>
                                            </div>
                                        
                                        <!-- Radio Field -->
                                        {% elif field.type == 'radio' %}
                                            <fieldset>
                                                <legend class="form-label">
                                                    {{ field.label }}
                                                    {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                    <i class="fas fa-info-circle ms-1 field-help" data-bs-toggle="tooltip" title="{{ field.help_text }}"></i>
                                                </legend>
                                                
                                                {% for option in field.options %}
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" 
                                                               name="{{ field.name }}" id="{{ field.name }}_{{ loop.index }}"
                                                               value="{{ option.value }}" {% if field.required %}required{% endif %}>
                                                        <label class="form-check-label" for="{{ field.name }}_{{ loop.index }}">
                                                            {{ option.label }}
                                                        </label>
                                                    </div>
                                                {% endfor %}
                                            </fieldset>
                                        
                                        <!-- Select Field -->
                                        {% elif field.type == 'select' %}
                                            <label for="{{ field.name }}" class="form-label">
                                                {{ field.label }}
                                                {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                <i class="fas fa-info-circle ms-1 field-help" data-bs-toggle="tooltip" title="{{ field.help_text }}"></i>
                                            </label>
                                            <select class="form-select" id="{{ field.name }}" name="{{ field.name }}"
                                                    {% if field.required %}required{% endif %}>
                                                <option value="">-- Select --</option>
                                                {% for option in field.options %}
                                                    <option value="{{ option.value }}">{{ option.label }}</option>
                                                {% endfor %}
                                            </select>
                                        
                                        <!-- Default Field (Text) -->
                                        {% else %}
                                            <label for="{{ field.name }}" class="form-label">
                                                {{ field.label }}
                                                {% if field.required %}<span class="text-danger">*</span>{% endif %}
                                                <i class="fas fa-info-circle ms-1 field-help" data-bs-toggle="tooltip" title="{{ field.help_text }}"></i>
                                            </label>
                                            <input type="text" class="form-control" id="{{ field.name }}" name="{{ field.name }}"
                                                   {% if field.required %}required{% endif %}>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                            
                            <!-- Navigation -->
                            <div class="form-navigation">
                                <div>
                                    {% if current_section > 0 %}
                                        <a href="{{ url_for('form_demo') }}?form_id={{ selected_form_id }}&section={{ current_section - 1 }}" 
                                           class="btn btn-secondary">
                                            <i class="fas fa-arrow-left me-2"></i> Previous
                                        </a>
                                    {% endif %}
                                </div>
                                
                                <div>
                                    {% if current_section < form_template.sections|length - 1 %}
                                        <a href="{{ url_for('form_demo') }}?form_id={{ selected_form_id }}&section={{ current_section + 1 }}" 
                                           class="btn btn-primary">
                                            Next <i class="fas fa-arrow-right ms-2"></i>
                                        </a>
                                    {% else %}
                                        <button type="button" class="btn btn-success" id="completeBtn">
                                            <i class="fas fa-check-circle me-2"></i> Complete Form
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            {% else %}
                <div class="card shadow-sm">
                    <div class="card-body text-center p-5">
                        <i class="fas fa-file-invoice fa-5x text-muted mb-4"></i>
                        <h3>Select a Form Template</h3>
                        <p class="text-muted mb-0">Please select a form template from the list to view it</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="successModalLabel">Form Completed</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fas fa-check-circle fa-5x text-success mb-3"></i>
                    <h4>Success!</h4>
                    <p>Your form has been successfully submitted.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tooltips
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
        
        // Initialize Success Modal
        const successModal = new bootstrap.Modal(document.getElementById('successModal'));
        
        // Complete Form Button
        const completeBtn = document.getElementById('completeBtn');
        if (completeBtn) {
            completeBtn.addEventListener('click', function() {
                successModal.show();
            });
        }
        
        // Save Button
        const saveBtn = document.getElementById('saveBtn');
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                alert('Form progress saved!');
            });
        }
        
        // Submit Button
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                successModal.show();
            });
        }
        
        // Reset Button
        const resetBtn = document.getElementById('resetBtn');
        if (resetBtn) {
            resetBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
                    document.getElementById('demoForm').reset();
                }
            });
        }
    });
</script>
{% endblock %}