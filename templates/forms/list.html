{% extends 'layout.html' %}

{% block title %}My Tax Forms{% endblock %}

{% block extra_head %}
<style>
  .form-card {
    transition: all 0.3s ease;
    border-radius: 10px;
    overflow: hidden;
  }
  
  .form-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }
  
  .form-status {
    position: absolute;
    top: 12px;
    right: 12px;
  }
  
  .form-card-icon {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    background-color: rgba(255, 107, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--fylr-orange);
    font-size: 24px;
  }
  
  .form-filters {
    background-color: rgba(255, 107, 0, 0.05);
    border-radius: 10px;
    padding: 15px;
  }
  
  .empty-forms {
    text-align: center;
    padding: 60px 0;
  }
  
  .empty-forms i {
    color: var(--fylr-orange);
    opacity: 0.3;
    margin-bottom: 20px;
  }
  
  .new-form-card {
    border: 2px dashed rgba(255, 107, 0, 0.3);
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .new-form-card:hover {
    border-color: var(--fylr-orange);
    background-color: rgba(255, 107, 0, 0.05);
  }
  
  .new-form-card i {
    font-size: 32px;
    color: var(--fylr-orange);
    margin-bottom: 10px;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-0">My Tax Forms</h1>
            <p class="lead text-muted">Manage and view all your tax forms</p>
        </div>
        <div>
            <a href="{{ url_for('forms.new_form') }}" class="btn btn-primary">
                <i class="fas fa-plus-circle me-2"></i> Create New Form
            </a>
        </div>
    </div>
    
    <!-- Filters -->
    <div class="form-filters mb-4">
        <div class="row g-3">
            <div class="col-md-4">
                <label for="yearFilter" class="form-label">Tax Year</label>
                <select class="form-select" id="yearFilter">
                    <option value="all">All Years</option>
                    {% for year in range(current_year, current_year-4, -1) %}
                        <option value="{{ year }}">{{ year }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-4">
                <label for="statusFilter" class="form-label">Status</label>
                <select class="form-select" id="statusFilter">
                    <option value="all">All Status</option>
                    <option value="completed">Completed</option>
                    <option value="draft">Draft</option>
                    <option value="in_progress">In Progress</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="typeFilter" class="form-label">Form Type</label>
                <select class="form-select" id="typeFilter">
                    <option value="all">All Types</option>
                    {% for form_type in form_types %}
                        <option value="{{ form_type.id }}">{{ form_type.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>
    
    {% if forms %}
        <!-- Form Cards -->
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="formCards">
            <!-- Create New Form Card (Always shown) -->
            <div class="col" data-year="all" data-status="all" data-type="all">
                <a href="{{ url_for('forms.new_form') }}" class="card form-card new-form-card h-100 text-decoration-none">
                    <div class="text-center">
                        <i class="fas fa-plus-circle"></i>
                        <h5>Create New Form</h5>
                        <p class="text-muted small mb-0">Start a new tax form</p>
                    </div>
                </a>
            </div>
            
            <!-- Form Cards -->
            {% for form in forms %}
                <div class="col form-item" 
                     data-year="{{ form.tax_year }}"
                     data-status="{{ form.status }}"
                     data-type="{{ form.form_type.name|lower }}">
                    <div class="card form-card h-100">
                        <div class="card-body position-relative">
                            <span class="badge bg-{{ 'success' if form.status == 'completed' else 'warning' }} form-status">
                                {{ form.status|title }}
                            </span>
                            
                            <div class="d-flex mb-3">
                                <div class="form-card-icon me-3">
                                    <i class="fas fa-file-invoice"></i>
                                </div>
                                <div>
                                    <h5 class="card-title mb-0">{{ form.form_type.name|replace('_', ' ')|title }}</h5>
                                    <p class="card-text text-muted small">Tax Year: {{ form.tax_year }}</p>
                                </div>
                            </div>
                            
                            <div class="form-meta mb-3">
                                <div class="row row-cols-2 g-2">
                                    <div class="col">
                                        <div class="text-muted small">Created</div>
                                        <div>{{ form.created_at.strftime('%b %d, %Y') }}</div>
                                    </div>
                                    <div class="col">
                                        <div class="text-muted small">Updated</div>
                                        <div>{{ form.updated_at.strftime('%b %d, %Y') }}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <a href="{{ url_for('forms.view_form', form_id=form.id) }}" class="btn btn-outline-primary">
                                    <i class="fas fa-eye me-2"></i> View Form
                                </a>
                                {% if form.status == 'completed' and form.pdf_path %}
                                    <a href="{{ url_for('forms.download_form', form_id=form.id) }}" class="btn btn-outline-success">
                                        <i class="fas fa-download me-2"></i> Download PDF
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <!-- Empty State -->
        <div class="empty-forms">
            <i class="fas fa-file-invoice fa-5x"></i>
            <h3>No Tax Forms Yet</h3>
            <p class="text-muted mb-4">Create your first tax form to get started with filing your taxes.</p>
            <a href="{{ url_for('forms.new_form') }}" class="btn btn-primary btn-lg">
                <i class="fas fa-plus-circle me-2"></i> Create Your First Form
            </a>
        </div>
    {% endif %}
    
    <!-- Form Type Information -->
    <div class="card mt-5">
        <div class="card-header">
            <h5 class="mb-0">Available Tax Forms</h5>
        </div>
        <div class="card-body">
            <div class="row row-cols-1 row-cols-md-2 g-4">
                {% for form_type in form_types %}
                    <div class="col">
                        <div class="d-flex">
                            <div class="form-card-icon me-3">
                                <i class="fas fa-{% if 'schedule' in form_type.id|lower %}clipboard-list{% else %}file-alt{% endif %}"></i>
                            </div>
                            <div>
                                <h5 class="mb-1">{{ form_type.name }}</h5>
                                <p class="text-muted small mb-1">{{ form_type.description }}</p>
                                <div>
                                    <span class="badge bg-light text-dark">{{ form_type.entity_type|replace('_', ' ')|title }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set up filtering
        const yearFilter = document.getElementById('yearFilter');
        const statusFilter = document.getElementById('statusFilter');
        const typeFilter = document.getElementById('typeFilter');
        const formItems = document.querySelectorAll('.form-item');
        
        // Filter function
        function filterForms() {
            const yearValue = yearFilter.value;
            const statusValue = statusFilter.value;
            const typeValue = typeFilter.value;
            
            formItems.forEach(item => {
                const yearMatch = yearValue === 'all' || item.dataset.year === yearValue;
                const statusMatch = statusValue === 'all' || item.dataset.status === statusValue;
                const typeMatch = typeValue === 'all' || item.dataset.type === typeValue;
                
                if (yearMatch && statusMatch && typeMatch) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // Add event listeners
        yearFilter.addEventListener('change', filterForms);
        statusFilter.addEventListener('change', filterForms);
        typeFilter.addEventListener('change', filterForms);
    });
</script>
{% endblock %}